<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ë‹ˆì§€ìŠ¤íŠ¸ë§</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Bebas+Neue&display=swap');

  :root {
    --bg: #0f0f13;
    --surface: #1a1a22;
    --surface2: #22222e;
    --border: #2e2e3e;
    --accent: #7c6af7;
    --accent2: #f76ac8;
    --text: #e8e8f0;
    --text-muted: #7a7a95;
    --success: #4ade80;
    --danger: #f87171;
    --warn: #fbbf24;
    --radius: 14px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: 'Noto Sans KR', sans-serif; font-size: 15px; overflow: hidden; }

  /* ===== APP SHELL ===== */
  #app { display: flex; flex-direction: column; height: 100vh; max-width: 480px; margin: 0 auto; position: relative; }

  /* ===== TOP BAR ===== */
  .topbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 20px 12px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    position: relative;
    z-index: 10;
    flex-shrink: 0;
  }
  .topbar-logo { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 2px; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .topbar-avatar {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; font-weight: 700; cursor: pointer;
    position: relative;
  }
  .topbar-avatar::after { content: ''; position: absolute; inset: -2px; border-radius: 50%; border: 2px solid transparent; background: linear-gradient(135deg, var(--accent), var(--accent2)) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; }

  /* ===== CONTENT ===== */
  .content { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 16px; scroll-behavior: smooth; }
  .content::-webkit-scrollbar { width: 4px; }
  .content::-webkit-scrollbar-track { background: transparent; }
  .content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* ===== BOTTOM NAV ===== */
  .nav {
    display: flex; background: var(--surface); border-top: 1px solid var(--border);
    padding: 12px 0 max(48px, calc(env(safe-area-inset-bottom) + 36px));
    flex-shrink: 0;
  }
  .nav-btn {
    flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px;
    padding: 6px 4px; background: none; border: none; color: var(--text-muted);
    font-family: inherit; font-size: 10px; cursor: pointer; transition: all .2s;
    position: relative;
  }
  .nav-btn svg { width: 22px; height: 22px; }
  .nav-btn.active { color: var(--accent); }
  .nav-btn.active::after {
    content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    width: 24px; height: 2px; background: var(--accent); border-radius: 0 0 2px 2px;
  }

  /* ===== PAGES ===== */
  .page { display: none; animation: fadeUp .3s ease; }
  .page.active { display: block; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* ===== SECTION TITLE ===== */
  .section-title {
    font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;
    color: var(--text-muted); margin: 20px 0 10px;
  }
  .section-title:first-child { margin-top: 0; }

  /* ===== CARDS ===== */
  .card {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 16px; margin-bottom: 10px;
  }
  .card-title { font-size: 13px; font-weight: 700; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }

  /* ===== FORM ELEMENTS ===== */
  .form-group { margin-bottom: 14px; }
  .form-label { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; display: block; font-weight: 500; }
  .form-input, .form-select, .form-textarea {
    width: 100%; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px;
    color: var(--text); font-family: inherit; font-size: 14px; padding: 11px 14px;
    outline: none; transition: border-color .2s;
    -webkit-appearance: none;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--accent); }
  .form-select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237a7a95' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; padding-right: 40px; }
  .form-select option { background: var(--surface2); }
  .form-textarea { resize: vertical; min-height: 70px; }

  /* ===== BUTTONS ===== */
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 6px;
    padding: 12px 20px; border-radius: 10px; border: none; font-family: inherit;
    font-size: 14px; font-weight: 600; cursor: pointer; transition: all .2s; width: 100%;
  }
  .btn-primary { background: linear-gradient(135deg, var(--accent), #6256e0); color: #fff; }
  .btn-primary:active { transform: scale(.97); }
  .btn-secondary { background: var(--surface2); border: 1px solid var(--border); color: var(--text); }
  .btn-danger { background: rgba(248,113,113,.15); border: 1px solid rgba(248,113,113,.3); color: var(--danger); }
  .btn-sm { padding: 7px 14px; font-size: 12px; border-radius: 8px; width: auto; }
  .btn-icon { width: 32px; height: 32px; padding: 0; border-radius: 8px; width: auto; }

  /* ===== MATCH RESULT ===== */
  .match-result { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 14px; }
  .match-result-label { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; text-align: center; }
  .match-score-input { width: 64px; text-align: center; font-size: 22px; font-weight: 700; }
  .vs-text { font-size: 12px; color: var(--text-muted); font-weight: 700; }
  .match-result-winner { display: flex; gap: 8px; justify-content: center; }
  .winner-btn {
    flex: 1; padding: 10px; border-radius: 10px; border: 1.5px solid var(--border);
    background: var(--surface2); color: var(--text-muted); font-family: inherit;
    font-size: 13px; font-weight: 600; cursor: pointer; transition: all .2s;
  }
  .winner-btn.selected-win { border-color: var(--success); background: rgba(74,222,128,.1); color: var(--success); }
  .winner-btn.selected-lose { border-color: var(--danger); background: rgba(248,113,113,.1); color: var(--danger); }

  /* ===== STAT CARDS ===== */
  .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
  .stat-box {
    background: var(--surface2); border-radius: 12px; padding: 12px 6px;
    text-align: center; border: 1px solid var(--border);
  }
  .stat-num { font-size: 22px; font-weight: 900; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .stat-lbl { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

  /* ===== MATCH ITEM ===== */
  .match-item {
    background: var(--surface2); border-radius: 12px; padding: 12px 14px;
    margin-bottom: 8px; border: 1px solid var(--border); position: relative;
  }
  .match-item-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding-right: 30px; }
  .match-badge { font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 20px; }
  .badge-win { background: rgba(74,222,128,.15); color: var(--success); border: 1px solid rgba(74,222,128,.3); }
  .badge-lose { background: rgba(248,113,113,.15); color: var(--danger); border: 1px solid rgba(248,113,113,.3); }
  .match-date { font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 4px; flex-wrap: wrap; }
  .match-item-main { display: flex; align-items: center; justify-content: center; gap: 12px; }
  .match-team { flex: 1; text-align: center; font-size: 13px; font-weight: 600; }
  .match-score-big { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 4px; }
  .match-score-win { color: var(--success); }
  .match-score-lose { color: var(--danger); }
  .match-delete-btn {
    position: absolute; top: 10px; right: 10px;
    background: none; border: none; color: var(--text-muted); cursor: pointer;
    padding: 4px; border-radius: 6px; font-size: 14px; display: flex;
    transition: color .2s;
  }
  .match-delete-btn:hover { color: var(--danger); }

  /* ===== RANKING TABLE ===== */
  .rank-table { width: 100%; border-collapse: collapse; }
  .rank-table th { font-size: 11px; color: var(--text-muted); font-weight: 600; text-align: left; padding: 0 8px 10px; text-transform: uppercase; letter-spacing: .5px; }
  .rank-table td { padding: 10px 8px; border-top: 1px solid var(--border); font-size: 13px; vertical-align: middle; }
  .rank-table tr:hover td { background: var(--surface2); }
  .rank-num { width: 28px; font-weight: 900; color: var(--text-muted); font-size: 12px; }
  .rank-first .rank-num { color: var(--warn); }
  .rank-second .rank-num { color: #9ca3af; }
  .rank-third .rank-num { color: #cd7c2f; }
  .rank-rate { font-weight: 700; color: var(--accent); }
  .rank-me td { background: rgba(124,106,247,.15) !important; border-top: 2px solid var(--accent); border-bottom: 2px solid var(--accent); }
  .rank-me:hover td { background: rgba(124,106,247,.25) !important; }

  /* ===== PLAYER LIST ===== */
  .player-list { list-style: none; }
  .player-item {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 12px;
    margin-bottom: 8px; overflow: hidden; transition: all .2s;
  }
  .player-item-main {
    display: flex; align-items: center; gap: 12px; padding: 12px 14px;
  }
  .player-avatar-sm {
    width: 44px; height: 56px; border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; font-weight: 700; flex-shrink: 0;
  }
  .player-info { flex: 1; min-width: 0; }
  .player-name { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
  .player-meta { font-size: 11px; color: var(--text-muted); }
  .player-memo-preview {
    font-size: 11px; color: var(--accent); margin-top: 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    max-width: 180px;
  }
  .player-actions { display: flex; gap: 6px; flex-shrink: 0; }
  .player-action-btn {
    width: 30px; height: 30px; border-radius: 8px; border: none;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all .2s; background: var(--surface);
    color: var(--text-muted);
  }
  .player-action-btn:hover { color: var(--text); }
  .player-action-btn.edit-btn:hover { background: rgba(124,106,247,.2); color: var(--accent); }
  .player-action-btn.delete-btn:hover { background: rgba(248,113,113,.2); color: var(--danger); }
  .player-memo-area {
    border-top: 1px solid var(--border);
    padding: 10px 14px;
    background: rgba(124,106,247,.05);
    display: none;
  }
  .player-memo-area.open { display: block; }
  .player-memo-input {
    width: 100%; background: var(--surface); border: 1px solid var(--border);
    border-radius: 8px; color: var(--text); font-family: inherit; font-size: 13px;
    padding: 8px 12px; outline: none; resize: none; min-height: 60px; transition: border-color .2s;
  }
  .player-memo-input:focus { border-color: var(--accent); }
  .memo-save-btn {
    margin-top: 8px; padding: 7px 14px; background: linear-gradient(135deg, var(--accent), #6256e0);
    border: none; border-radius: 8px; color: #fff; font-family: inherit; font-size: 12px;
    font-weight: 600; cursor: pointer; transition: all .2s;
  }
  .memo-save-btn:active { transform: scale(.96); }
  .memo-label { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; font-weight: 600; letter-spacing: .5px; }

  /* ===== ADD PLAYER AREA ===== */
  .add-player-row { display: flex; gap: 8px; margin-bottom: 12px; }
  .add-player-row .form-input { flex: 1; }

  /* ===== PROFILE ===== */
  .profile-hero {
    background: linear-gradient(135deg, rgba(124,106,247,.15), rgba(247,106,200,.1));
    border: 1px solid var(--border); border-radius: var(--radius);
    padding: 24px; text-align: center; margin-bottom: 12px;
  }
  .profile-avatar-big {
    width: 140px; height: 180px; border-radius: 16px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 48px; font-weight: 700; margin: 0 auto 12px;
    position: relative; overflow: hidden;
  }
  #avatarInitial {
    display: flex; align-items: center; justify-content: center;
    width: 100%; height: 100%; position: relative; z-index: 1;
  }
  .profile-name-big { font-size: 22px; font-weight: 900; margin-bottom: 4px; }
  .profile-sub { font-size: 12px; color: var(--text-muted); }

  /* ===== MODAL ===== */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,.7); z-index: 100;
    display: flex; align-items: flex-end; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity .3s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface); border-radius: 20px 20px 0 0;
    padding: 20px 20px max(20px, env(safe-area-inset-bottom));
    width: 100%; max-width: 480px; max-height: 85vh; overflow-y: auto;
    transform: translateY(100%); transition: transform .3s cubic-bezier(.32,.72,0,1);
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .modal-title { font-size: 18px; font-weight: 700; }
  .modal-close { background: var(--surface2); border: none; width: 32px; height: 32px; border-radius: 50%; color: var(--text); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

  /* ===== TOAST ===== */
  .toast {
    position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px);
    background: var(--surface); border: 1px solid var(--accent); border-radius: 12px;
    padding: 10px 20px; font-size: 13px; font-weight: 600; color: var(--text);
    z-index: 999; opacity: 0; transition: all .3s; pointer-events: none; white-space: nowrap;
    box-shadow: 0 8px 32px rgba(0,0,0,.5);
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ===== SHARE PAGE ===== */
  .share-btn-group { display: flex; flex-direction: column; gap: 8px; }
  .share-item { display: flex; align-items: center; gap: 12px; background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; padding: 14px 16px; cursor: pointer; transition: all .2s; }
  .share-item:hover { border-color: var(--accent); }
  .share-icon { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
  .share-text { font-size: 14px; font-weight: 600; }
  .share-sub { font-size: 11px; color: var(--text-muted); margin-top: 1px; }

  /* ===== PILL TABS ===== */
  .pill-tabs { display: flex; gap: 6px; background: var(--surface2); border-radius: 12px; padding: 4px; margin-bottom: 14px; }
  .pill-tab { flex: 1; padding: 8px; border: none; background: none; color: var(--text-muted); font-family: inherit; font-size: 12px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all .2s; }
  .pill-tab.active { background: var(--accent); color: #fff; }

  /* ===== EMPTY STATE ===== */
  .empty-state { text-align: center; padding: 40px 20px; color: var(--text-muted); }
  .empty-icon { font-size: 40px; margin-bottom: 12px; opacity: .4; }
  .empty-text { font-size: 14px; line-height: 1.6; }

  /* ===== INLINE EDIT FORM ===== */
  .player-edit-area {
    border-top: 1px solid var(--border);
    padding: 12px 14px;
    background: rgba(124,106,247,.05);
    display: none;
  }
  .player-edit-area.open { display: block; }
  .edit-row { display: flex; gap: 8px; align-items: center; }
  .edit-row .form-input { flex: 1; padding: 9px 12px; font-size: 13px; }
  .edit-confirm-btn {
    padding: 9px 14px; background: linear-gradient(135deg, var(--accent), #6256e0);
    border: none; border-radius: 8px; color: #fff; font-family: inherit; font-size: 12px;
    font-weight: 600; cursor: pointer; white-space: nowrap;
  }
  .edit-cancel-btn {
    padding: 9px 12px; background: var(--surface); border: 1px solid var(--border);
    border-radius: 8px; color: var(--text-muted); font-family: inherit; font-size: 12px;
    font-weight: 600; cursor: pointer; white-space: nowrap;
  }

  /* ===== CONFIRM DIALOG ===== */
  .confirm-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,.8); z-index: 200;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity .2s;
    padding: 24px;
  }
  .confirm-overlay.open { opacity: 1; pointer-events: all; }
  .confirm-box {
    background: var(--surface); border-radius: 18px; padding: 24px;
    width: 100%; max-width: 300px; text-align: center;
    transform: scale(.9); transition: transform .2s;
  }
  .confirm-overlay.open .confirm-box { transform: scale(1); }
  .confirm-icon { font-size: 36px; margin-bottom: 12px; }
  .confirm-title { font-size: 17px; font-weight: 700; margin-bottom: 8px; }
  .confirm-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }
  .confirm-btns { display: flex; gap: 10px; }
  .confirm-btns button { flex: 1; }

  /* FORMAT BADGE */
  .format-badge { font-size: 10px; padding: 2px 7px; border-radius: 20px; background: rgba(124,106,247,.15); color: var(--accent); border: 1px solid rgba(124,106,247,.3); white-space: nowrap; }

  /* ===== OPPONENT WIN/LOSE BAR ===== */
  .opponent-bar { margin-bottom: 10px; }
  .opponent-name { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; }
  .bar-track { background: var(--surface2); border-radius: 20px; height: 6px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 20px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .5s ease; }

  .page-header { font-size: 20px; font-weight: 900; margin-bottom: 6px; }
  .page-sub { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }
</style>
</head>
<body>
<div id="app">
  <div class="topbar">
    <span class="topbar-logo">ë‹ˆì§€ìŠ¤íŠ¸ë§</span>
    <div class="topbar-avatar" id="avatarBtn" onclick="showPage('profile')">A</div>
  </div>

  <div class="content">
    <!-- ===== PROFILE PAGE ===== -->
    <div class="page active" id="page-profile">
      <div class="profile-hero">
        <div class="profile-avatar-big" id="profileAvatarBig" onclick="document.getElementById('photoUpload').click()" style="cursor:pointer;position:relative;overflow:hidden;">
          <span id="avatarInitial">A</span>
          <img id="avatarImage" style="display:none;width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0;">
        </div>
        <input type="file" id="photoUpload" accept="image/*" style="display:none" onchange="uploadPhoto(this)">
        <div style="font-size:11px;color:var(--text-muted);margin-top:8px;cursor:pointer;" onclick="document.getElementById('photoUpload').click()">ğŸ“· ì‚¬ì§„ ë³€ê²½</div>
        <div class="profile-name-big" id="profileNameBig">ì„ ìˆ˜</div>
        <div class="profile-sub" id="profileSubBig">ì •ë³´ ì—†ìŒ</div>
      </div>
      
      <button class="btn btn-secondary" onclick="toggleProfileSettings()" style="margin-bottom:12px;">
        âš™ï¸ <span id="settingsToggleText">í”„ë¡œí•„ ì„¤ì • ì—´ê¸°</span>
      </button>
      
      <div class="card" id="profileSettings" style="display:none;">
        <div class="card-title">í”„ë¡œí•„ ì„¤ì •</div>
        <div class="form-group">
          <label class="form-label">ì´ë¦„</label>
          <input class="form-input" id="profileName" placeholder="ì´ë¦„ ì…ë ¥">
        </div>
        <div class="form-group">
          <label class="form-label">ë‚˜ì´ëŒ€</label>
          <select class="form-select" id="profileAge">
            <option value="">ì„ íƒ</option>
            <option>10ëŒ€</option><option>20ëŒ€</option><option>30ëŒ€</option>
            <option>40ëŒ€</option><option>50ëŒ€</option><option>60ëŒ€ ì´ìƒ</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ê²½ë ¥</label>
          <select class="form-select" id="profileCareer">
            <option value="">ì„ íƒ</option>
            <option>6ê°œì›” ë¯¸ë§Œ</option><option>6ê°œì›”~1ë…„</option><option>1~2ë…„</option>
            <option>2~5ë…„</option><option>5~10ë…„</option><option>10ë…„ ì´ìƒ</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ì†ì¡ì´</label>
          <select class="form-select" id="profileHand">
            <option value="">ì„ íƒ</option>
            <option>ì˜¤ë¥¸ì†</option><option>ì™¼ì†</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">í”Œë ˆì´ ìŠ¤íƒ€ì¼</label>
          <select class="form-select" id="profileStyle">
            <option value="">ì„ íƒ</option>
            <option>ê³µê²©í˜•</option><option>ìˆ˜ë¹„í˜•</option><option>ì˜¬ë¼ìš´ë“œ</option>
            <option>ë„¤íŠ¸í”Œë ˆì´</option><option>ë² ì´ìŠ¤ë¼ì¸</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="saveProfile()">ì €ì¥</button>
      </div>
    </div>

    <!-- ===== MATCH PAGE ===== -->
    <div class="page" id="page-match">
      <div class="page-header">ê²½ê¸°ê¸°ë¡</div>
      <div class="page-sub">ìƒˆ ê²½ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>

      <div class="card">
        <div class="card-title">ìƒˆ ê²½ê¸°</div>
        <div class="form-group">
          <label class="form-label">ë‚ ì§œ</label>
          <input type="date" class="form-input" id="matchDate">
        </div>
        <div class="form-group">
          <label class="form-label">í˜•ì‹</label>
          <select class="form-select" id="matchFormat" onchange="togglePartner()">
            <option value="">ì„ íƒ</option>
            <option value="singles">ë‹¨ì‹</option>
            <option value="doubles">ë³µì‹</option>
          </select>
        </div>
        <div class="form-group" id="partnerGroup" style="display:none">
          <label class="form-label">íŒŒíŠ¸ë„ˆ</label>
          <input class="form-input" id="matchPartner" placeholder="íŒŒíŠ¸ë„ˆ ì´ë¦„">
        </div>
        <div class="form-group">
          <label class="form-label">ìƒëŒ€</label>
          <input class="form-input" id="matchOpponent" placeholder="ìƒëŒ€ ì´ë¦„">
        </div>
        <div class="form-group" id="opponent2Group" style="display:none">
          <label class="form-label">ìƒëŒ€ 2</label>
          <input class="form-input" id="matchOpponent2" placeholder="ìƒëŒ€ 2 ì´ë¦„">
        </div>

        <div class="form-group">
          <label class="form-label">ê²°ê³¼</label>
          <div class="match-result-winner">
            <button class="winner-btn" id="winBtn" onclick="setResult('win')">ğŸ† ìŠ¹ë¦¬</button>
            <button class="winner-btn" id="loseBtn" onclick="setResult('lose')">ğŸ˜” íŒ¨ë°°</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ìŠ¤ì½”ì–´ (ì„ íƒ)</label>
          <div class="match-result">
            <div>
              <div class="match-result-label">ë‚˜</div>
              <input type="number" class="form-input match-score-input" id="myScore" placeholder="0" min="0" max="99">
            </div>
            <div class="vs-text">VS</div>
            <div>
              <div class="match-result-label">ìƒëŒ€</div>
              <input type="number" class="form-input match-score-input" id="oppScore" placeholder="0" min="0" max="99">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">íƒ€ì´ë¸Œë ˆì´í¬ ì ìˆ˜ (ì„ íƒ)</label>
          <div class="match-result">
            <div>
              <div class="match-result-label">ë‚˜</div>
              <input type="number" class="form-input match-score-input" id="myTiebreak" placeholder="-" min="0" max="99">
            </div>
            <div class="vs-text">VS</div>
            <div>
              <div class="match-result-label">ìƒëŒ€</div>
              <input type="number" class="form-input match-score-input" id="oppTiebreak" placeholder="-" min="0" max="99">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ë©”ëª¨</label>
          <textarea class="form-textarea" id="matchMemo" placeholder="ê²½ê¸° ë©”ëª¨..."></textarea>
        </div>
        <button class="btn btn-primary" onclick="saveMatch()">ê²½ê¸° ì €ì¥</button>
      </div>

      <div class="section-title">ìµœê·¼ ê²½ê¸°</div>
      <div id="matchList"></div>
    </div>

    <!-- ===== STATS PAGE ===== -->
    <div class="page" id="page-stats">
      <div class="page-header">í†µê³„</div>
      <div class="page-sub">
        ë‚˜ì˜ 
        <select id="sportType" onchange="updateSportType()" style="background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--accent);font-weight:700;padding:2px 8px;font-size:13px;outline:none;cursor:pointer;">
          <option value="badminton">ë°°ë“œë¯¼í„´</option>
          <option value="tennis">í…Œë‹ˆìŠ¤</option>
        </select>
        ê¸°ë¡
      </div>

      <div class="section-title">ì „ì²´ í†µê³„</div>
      <div class="stat-grid">
        <div class="stat-box"><div class="stat-num" id="st-total">0</div><div class="stat-lbl">ì´ ê²½ê¸°</div></div>
        <div class="stat-box"><div class="stat-num" id="st-win">0</div><div class="stat-lbl">ìŠ¹</div></div>
        <div class="stat-box"><div class="stat-num" id="st-lose">0</div><div class="stat-lbl">íŒ¨</div></div>
        <div class="stat-box"><div class="stat-num" id="st-rate">0%</div><div class="stat-lbl">ìŠ¹ë¥ </div></div>
      </div>

      <div class="section-title">í˜•ì‹ë³„</div>
      <div class="card">
        <div style="display:flex;gap:16px;">
          <div style="flex:1;text-align:center;">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">ë‹¨ì‹</div>
            <div style="font-size:18px;font-weight:700;" id="st-singles">0-0</div>
          </div>
          <div style="width:1px;background:var(--border);"></div>
          <div style="flex:1;text-align:center;">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">ë³µì‹</div>
            <div style="font-size:18px;font-weight:700;" id="st-doubles">0-0</div>
          </div>
        </div>
      </div>

      <div class="section-title">ì„ ìˆ˜ ìˆœìœ„</div>
      <div class="card" id="rankingCard">
        <div class="empty-state"><div class="empty-icon">ğŸ¸</div><div class="empty-text">ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´<br>ìˆœìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>
      </div>

      <div class="section-title">íŒŒíŠ¸ë„ˆë³„ ìŠ¹ë¥ </div>
      <div class="card" id="partnerCard">
        <div class="empty-state"><div class="empty-icon">ğŸ¤</div><div class="empty-text">ë³µì‹ ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´<br>íŒŒíŠ¸ë„ˆ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>
      </div>

      <div class="section-title">ìƒëŒ€ë³„ ìŠ¹ë¥ </div>
      <div class="card" id="opponentCard">
        <div class="empty-state"><div class="empty-icon">âš”ï¸</div><div class="empty-text">ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´<br>ìƒëŒ€ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>
      </div>
    </div>

    <!-- ===== PLAYERS PAGE ===== -->
    <div class="page" id="page-players">
      <div class="page-header">ì„ ìˆ˜ ëª©ë¡</div>
      <div class="page-sub">ë“±ë¡ëœ ì„ ìˆ˜ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</div>

      <div class="add-player-row">
        <input class="form-input" id="newPlayerName" placeholder="ì„ ìˆ˜ ì´ë¦„ ì…ë ¥" onkeydown="if(event.key==='Enter')addPlayer()">
        <button class="btn btn-primary btn-sm" onclick="addPlayer()" style="white-space:nowrap;padding:0 16px;">+ ì¶”ê°€</button>
      </div>

      <ul class="player-list" id="playerList"></ul>
    </div>

    <!-- ===== SHARE PAGE ===== -->
    <div class="page" id="page-share">
      <div class="page-header">ê³µìœ  & ë°±ì—…</div>
      <div class="page-sub">ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê±°ë‚˜ ê³µìœ í•˜ì„¸ìš”</div>

      <div class="section-title">ë°±ì—…</div>
      <div class="share-btn-group">
        <div class="share-item" onclick="exportData()">
          <div class="share-icon" style="background:rgba(74,222,128,.1);">ğŸ’¾</div>
          <div>
            <div class="share-text">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
            <div class="share-sub">JSON íŒŒì¼ë¡œ ì €ì¥</div>
          </div>
        </div>
        <label class="share-item" style="cursor:pointer;">
          <div class="share-icon" style="background:rgba(124,106,247,.1);">ğŸ“‚</div>
          <div>
            <div class="share-text">ê°€ì ¸ì˜¤ê¸°</div>
            <div class="share-sub">ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›</div>
          </div>
          <input type="file" accept=".json" style="display:none" onchange="importData(this)">
        </label>
      </div>

      <div class="section-title">ì‚¬ìš© ë°©ë²•</div>
      <div class="share-btn-group">
        <div class="share-item" onclick="showManual()">
          <div class="share-icon" style="background:rgba(251,191,36,.1);">ğŸ“–</div>
          <div>
            <div class="share-text">ì‚¬ìš© ì„¤ëª…ì„œ ë³´ê¸°</div>
            <div class="share-sub">ì•± ì‚¬ìš©ë²• ì•ˆë‚´</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== BOTTOM NAV ===== -->
  <nav class="nav">
    <button class="nav-btn active" onclick="showPage('profile')" id="nav-profile">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
      í”„ë¡œí•„
    </button>
    <button class="nav-btn" onclick="showPage('match')" id="nav-match">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
      ê²½ê¸°ê¸°ë¡
    </button>
    <button class="nav-btn" onclick="showPage('stats')" id="nav-stats">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 17l4-8 4 5 4-10 4 13"/></svg>
      í†µê³„
    </button>
    <button class="nav-btn" onclick="showPage('players')" id="nav-players">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      ì„ ìˆ˜
    </button>
    <button class="nav-btn" onclick="showPage('share')" id="nav-share">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      ê³µìœ 
    </button>
  </nav>
</div>

<!-- ===== MANUAL MODAL ===== -->
<div class="modal-overlay" id="manualModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">ğŸ“– ì‚¬ìš© ì„¤ëª…ì„œ</span>
      <button class="modal-close" onclick="closeModal('manualModal')">âœ•</button>
    </div>
    <p style="font-size:13px;line-height:1.8;color:var(--text-muted);">
      <b style="color:var(--text)">1. í”„ë¡œí•„ ì„¤ì •</b><br>
      ğŸ“· í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì•„ë°”íƒ€ í´ë¦­)<br>
      ì´ë¦„, ë‚˜ì´ëŒ€, ê²½ë ¥, ì†ì¡ì´, í”Œë ˆì´ ìŠ¤íƒ€ì¼ì„ ì €ì¥í•˜ì„¸ìš”.<br><br>
      
      <b style="color:var(--text)">2. ê²½ê¸° ê¸°ë¡</b><br>
      ë‚ ì§œ, í˜•ì‹(ë‹¨ì‹/ë³µì‹), ìƒëŒ€, ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br>
      ìŠ¤ì½”ì–´, íƒ€ì´ë¸Œë ˆì´í¬ ì ìˆ˜, ë©”ëª¨ëŠ” ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.<br>
      ì˜ˆ) 21:19 (11-9) - ì¼ë°˜ ìŠ¤ì½”ì–´ì™€ íƒ€ì´ë¸Œë ˆì´í¬ ì ìˆ˜<br><br>
      
      <b style="color:var(--text)">3. í†µê³„</b><br>
      ğŸ¸ ë°°ë“œë¯¼í„´ / ğŸ¾ í…Œë‹ˆìŠ¤ ì¢…ëª©ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      <b>ì„ ìˆ˜ ìˆœìœ„:</b> ì ìˆ˜ ì‹œìŠ¤í…œìœ¼ë¡œ ìˆœìœ„ê°€ ë§¤ê²¨ì§‘ë‹ˆë‹¤.<br>
      â€¢ ìŠ¹ë¦¬: +2ì  / íŒ¨ë°°: -1ì <br>
      â€¢ ì •ë ¬: ì ìˆ˜ â†’ ìŠ¹ë¥  ìˆœ<br>
      â€¢ ë‚´ ìˆœìœ„ëŠ” ë³´ë¼ìƒ‰ìœ¼ë¡œ ê°•ì¡° í‘œì‹œë©ë‹ˆë‹¤.<br>
      ìŠ¹ë¥ , í˜•ì‹ë³„, íŒŒíŠ¸ë„ˆë³„, ìƒëŒ€ë³„ í†µê³„ë¥¼ í™•ì¸í•˜ì„¸ìš”.<br><br>
      
      <b style="color:var(--text)">4. ì„ ìˆ˜ ëª©ë¡</b><br>
      í•¨ê»˜ ê²½ê¸°í•œ ì„ ìˆ˜ë¥¼ ë“±ë¡í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      â€¢ âœï¸ ë²„íŠ¼: ì´ë¦„ ìˆ˜ì •<br>
      â€¢ ğŸ“ ë²„íŠ¼: ì„ ìˆ˜ íŠ¹ì§• ë©”ëª¨ (ì˜ˆ: ìˆ˜ë¹„ ìŠ¤íƒ€ì¼, ë°œë¦¬ ì•½í•¨)<br>
      â€¢ ğŸ—‘ï¸ ë²„íŠ¼: ì„ ìˆ˜ ì‚­ì œ<br><br>
      
      <b style="color:var(--text)">5. ë°±ì—… & ê³µìœ </b><br>
      ğŸ’¾ ë°ì´í„° ë‚´ë³´ë‚´ê¸°: JSON íŒŒì¼ë¡œ ë°±ì—… ì €ì¥<br>
      ğŸ“‚ ê°€ì ¸ì˜¤ê¸°: ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›
    </p>
  </div>
</div>

<!-- ===== CONFIRM DIALOG ===== -->
<div class="confirm-overlay" id="confirmDialog">
  <div class="confirm-box">
    <div class="confirm-icon" id="confirmIcon">ğŸ—‘ï¸</div>
    <div class="confirm-title" id="confirmTitle">ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
    <div class="confirm-desc" id="confirmDesc">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
    <div class="confirm-btns">
      <button class="btn btn-secondary" onclick="closeConfirm()">ì·¨ì†Œ</button>
      <button class="btn btn-danger" id="confirmOkBtn" onclick="doConfirm()">ì‚­ì œ</button>
    </div>
  </div>
</div>

<!-- ===== TOAST ===== -->
<div class="toast" id="toast"></div>

<script>
// ===== STATE =====
let state = {
  profile: { name: '', age: '', career: '', hand: '', style: '', photo: '' },
  matches: [],
  players: [],  // { id, name, memo }
  currentResult: null,
  nextMatchId: 1,
  nextPlayerId: 1,
  sportType: 'badminton',
};

let confirmCallback = null;

// ===== STORAGE =====
function save() { localStorage.setItem('nijiData', JSON.stringify(state)); }
function load() {
  const d = localStorage.getItem('nijiData');
  if (d) {
    const parsed = JSON.parse(d);
    state = { ...state, ...parsed };
    // migrate old players format (strings â†’ objects)
    if (state.players.length && typeof state.players[0] === 'string') {
      state.players = state.players.map((n, i) => ({ id: i + 1, name: n, memo: '' }));
      state.nextPlayerId = state.players.length + 1;
    }
    // ensure all players have memo field
    state.players = state.players.map(p => ({ memo: '', ...p }));
    if (!state.nextMatchId) state.nextMatchId = state.matches.length + 1;
    if (!state.nextPlayerId) state.nextPlayerId = state.players.length + 1;
    if (!state.sportType) state.sportType = 'badminton';
    // restore sport type selector
    if (document.getElementById('sportType')) {
      document.getElementById('sportType').value = state.sportType;
    }
  }
}

// ===== NAVIGATION =====
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.getElementById('nav-' + name).classList.add('active');
  if (name === 'stats') renderStats();
  if (name === 'players') renderPlayers();
  if (name === 'match') renderMatchList();
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// ===== MODAL =====
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function showManual() { document.getElementById('manualModal').classList.add('open'); }

// ===== CONFIRM =====
function showConfirm(title, desc, icon, cb, okLabel = 'ì‚­ì œ') {
  document.getElementById('confirmTitle').textContent = title;
  document.getElementById('confirmDesc').textContent = desc;
  document.getElementById('confirmIcon').textContent = icon;
  document.getElementById('confirmOkBtn').textContent = okLabel;
  confirmCallback = cb;
  document.getElementById('confirmDialog').classList.add('open');
}
function closeConfirm() {
  document.getElementById('confirmDialog').classList.remove('open');
  confirmCallback = null;
}
function doConfirm() {
  if (confirmCallback) confirmCallback();
  closeConfirm();
}

// ===== PROFILE =====
function toggleProfileSettings() {
  const settings = document.getElementById('profileSettings');
  const toggleText = document.getElementById('settingsToggleText');
  if (settings.style.display === 'none') {
    settings.style.display = 'block';
    toggleText.textContent = 'í”„ë¡œí•„ ì„¤ì • ë‹«ê¸°';
  } else {
    settings.style.display = 'none';
    toggleText.textContent = 'í”„ë¡œí•„ ì„¤ì • ì—´ê¸°';
  }
}

function uploadPhoto(input) {
  const file = input.files[0];
  if (!file) return;
  
  // Check file size (max 2MB)
  if (file.size > 2 * 1024 * 1024) {
    showToast('âš ï¸ ì‚¬ì§„ í¬ê¸°ëŠ” 2MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    state.profile.photo = e.target.result;
    save();
    renderProfile();
    showToast('ğŸ“· ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ!');
  };
  reader.readAsDataURL(file);
}

function saveProfile() {
  state.profile = {
    name: document.getElementById('profileName').value.trim() || 'ì„ ìˆ˜',
    age: document.getElementById('profileAge').value,
    career: document.getElementById('profileCareer').value,
    hand: document.getElementById('profileHand').value,
    style: document.getElementById('profileStyle').value,
    photo: state.profile.photo || '',
  };
  save();
  renderProfile();
  document.getElementById('profileSettings').style.display = 'none';
  document.getElementById('settingsToggleText').textContent = 'í”„ë¡œí•„ ì„¤ì • ì—´ê¸°';
  showToast('âœ… í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!');
}
function renderProfile() {
  const p = state.profile;
  const name = p.name || 'ì„ ìˆ˜';
  const initial = name.charAt(0).toUpperCase();
  
  // Update topbar avatar
  document.getElementById('avatarBtn').textContent = initial;
  
  // Update profile page avatar
  const avatarInitial = document.getElementById('avatarInitial');
  const avatarImage = document.getElementById('avatarImage');
  if (p.photo) {
    avatarInitial.style.display = 'none';
    avatarImage.src = p.photo;
    avatarImage.style.display = 'block';
  } else {
    avatarInitial.textContent = initial;
    avatarInitial.style.display = 'flex';
    avatarImage.style.display = 'none';
  }
  
  document.getElementById('profileNameBig').textContent = name;
  const sub = [p.age, p.career, p.hand, p.style].filter(Boolean).join(' Â· ') || 'ì •ë³´ ì—†ìŒ';
  document.getElementById('profileSubBig').textContent = sub;
  document.getElementById('profileName').value = p.name;
  document.getElementById('profileAge').value = p.age;
  document.getElementById('profileCareer').value = p.career;
  document.getElementById('profileHand').value = p.hand;
  document.getElementById('profileStyle').value = p.style;
}

// ===== MATCH =====
function togglePartner() {
  const fmt = document.getElementById('matchFormat').value;
  document.getElementById('partnerGroup').style.display = fmt === 'doubles' ? 'block' : 'none';
  document.getElementById('opponent2Group').style.display = fmt === 'doubles' ? 'block' : 'none';
}
function setResult(r) {
  state.currentResult = r;
  document.getElementById('winBtn').className = 'winner-btn' + (r === 'win' ? ' selected-win' : '');
  document.getElementById('loseBtn').className = 'winner-btn' + (r === 'lose' ? ' selected-lose' : '');
}
function saveMatch() {
  const date = document.getElementById('matchDate').value;
  const format = document.getElementById('matchFormat').value;
  const opponent = document.getElementById('matchOpponent').value.trim();
  if (!date) { showToast('âš ï¸ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
  if (!format) { showToast('âš ï¸ í˜•ì‹ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
  if (!opponent) { showToast('âš ï¸ ìƒëŒ€ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
  if (!state.currentResult) { showToast('âš ï¸ ê²°ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }

  const match = {
    id: state.nextMatchId++,
    date,
    format,
    partner: format === 'doubles' ? document.getElementById('matchPartner').value.trim() : '',
    opponent,
    opponent2: format === 'doubles' ? document.getElementById('matchOpponent2').value.trim() : '',
    result: state.currentResult,
    myScore: document.getElementById('myScore').value,
    oppScore: document.getElementById('oppScore').value,
    myTiebreak: document.getElementById('myTiebreak').value,
    oppTiebreak: document.getElementById('oppTiebreak').value,
    memo: document.getElementById('matchMemo').value.trim(),
  };
  state.matches.unshift(match);

  // auto-add opponent to players
  [opponent, match.opponent2, match.partner].filter(Boolean).forEach(n => {
    if (!state.players.find(p => p.name === n)) {
      state.players.push({ id: state.nextPlayerId++, name: n, memo: '' });
    }
  });

  save();
  // reset
  state.currentResult = null;
  document.getElementById('winBtn').className = 'winner-btn';
  document.getElementById('loseBtn').className = 'winner-btn';
  document.getElementById('matchDate').value = '';
  document.getElementById('matchFormat').value = '';
  document.getElementById('matchOpponent').value = '';
  document.getElementById('matchOpponent2').value = '';
  document.getElementById('matchPartner').value = '';
  document.getElementById('myScore').value = '';
  document.getElementById('oppScore').value = '';
  document.getElementById('myTiebreak').value = '';
  document.getElementById('oppTiebreak').value = '';
  document.getElementById('matchMemo').value = '';
  togglePartner();
  renderMatchList();
  showToast('ğŸ¸ ê²½ê¸° ì €ì¥ ì™„ë£Œ!');
}
function renderMatchList() {
  const el = document.getElementById('matchList');
  if (!state.matches.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ¸</div><div class="empty-text">ì•„ì§ ê²½ê¸° ê¸°ë¡ì´ ì—†ì–´ìš”</div></div>';
    return;
  }
  el.innerHTML = state.matches.slice(0, 20).map(m => {
    const win = m.result === 'win';
    const scoreStr = (m.myScore !== '' && m.oppScore !== '') ? `${m.myScore} : ${m.oppScore}` : '';
    const tiebreakStr = (m.myTiebreak && m.myTiebreak !== '' && m.oppTiebreak && m.oppTiebreak !== '') ? ` (${m.myTiebreak}-${m.oppTiebreak})` : '';
    const opps = [m.opponent, m.opponent2].filter(Boolean).join(', ');
    const fmtLabel = m.format === 'doubles' ? 'ë³µì‹' : 'ë‹¨ì‹';
    return `<div class="match-item">
      <button class="match-delete-btn" onclick="deleteMatch(${m.id})">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
      </button>
      <div class="match-item-top">
        <span class="match-badge ${win ? 'badge-win' : 'badge-lose'}">${win ? 'ìŠ¹ë¦¬' : 'íŒ¨ë°°'}</span>
        <div class="match-date">
          <span>${m.date}</span>
          <span class="format-badge">${fmtLabel}</span>
        </div>
      </div>
      <div class="match-item-main">
        <div class="match-team" style="font-size:12px;">${state.profile.name || 'ë‚˜'}${m.partner ? '<br><span style="color:var(--text-muted);font-size:11px;">+'+m.partner+'</span>' : ''}</div>
        <div>
          ${scoreStr ? `<div class="match-score-big ${win ? 'match-score-win' : 'match-score-lose'}">${scoreStr}${tiebreakStr}</div>` : `<div style="color:var(--text-muted);font-size:12px;">VS</div>`}
        </div>
        <div class="match-team" style="font-size:12px;">${opps}</div>
      </div>
      ${m.memo ? `<div style="margin-top:8px;font-size:11px;color:var(--text-muted);border-top:1px solid var(--border);padding-top:8px;">ğŸ“ ${m.memo}</div>` : ''}
    </div>`;
  }).join('');
}
function deleteMatch(id) {
  showConfirm('ê²½ê¸° ì‚­ì œ', 'ì´ ê²½ê¸° ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 'ğŸ—‘ï¸', () => {
    state.matches = state.matches.filter(m => m.id !== id);
    save();
    renderMatchList();
    showToast('ğŸ—‘ï¸ ê²½ê¸° ì‚­ì œ ì™„ë£Œ');
  });
}

// ===== STATS =====
function updateSportType() {
  state.sportType = document.getElementById('sportType').value;
  save();
  renderStats();
  showToast(`ğŸ“Š ${state.sportType === 'badminton' ? 'ë°°ë“œë¯¼í„´' : 'í…Œë‹ˆìŠ¤'} í†µê³„ë¡œ ë³€ê²½`);
}

function renderStats() {
  const ms = state.matches;
  const total = ms.length;
  const wins = ms.filter(m => m.result === 'win').length;
  const loses = total - wins;
  const rate = total ? Math.round(wins / total * 100) : 0;
  document.getElementById('st-total').textContent = total;
  document.getElementById('st-win').textContent = wins;
  document.getElementById('st-lose').textContent = loses;
  document.getElementById('st-rate').textContent = rate + '%';

  const singles = ms.filter(m => m.format === 'singles');
  const doubles = ms.filter(m => m.format === 'doubles');
  const sw = singles.filter(m => m.result === 'win').length;
  const dw = doubles.filter(m => m.result === 'win').length;
  document.getElementById('st-singles').textContent = `${sw}-${singles.length - sw}`;
  document.getElementById('st-doubles').textContent = `${dw}-${doubles.length - dw}`;

  // ranking (opponents sorted by games played with me)
  renderRanking();
  renderPartnerStats();
  renderOpponentStats();
}

function renderRanking() {
  const myName = state.profile.name || 'ë‚˜';
  const playerMap = {};
  
  // ë‚´ ì ìˆ˜ ê³„ì‚°
  let myStats = { w: 0, l: 0, points: 0 };
  
  state.matches.forEach(m => {
    // ë‚´ ì „ì  ê³„ì‚°
    if (m.result === 'win') {
      myStats.w++;
      myStats.points += 2;
    } else {
      myStats.l++;
      myStats.points -= 1;
    }
    
    // ë‹¤ë¥¸ ì„ ìˆ˜ë“¤ ì „ì  ê³„ì‚°
    [m.opponent, m.opponent2, m.partner].filter(Boolean).forEach(name => {
      if (name === myName) return;
      
      if (!playerMap[name]) playerMap[name] = { w: 0, l: 0, points: 0 };
      
      // ìƒëŒ€í¸ì¸ ê²½ìš°
      if (name === m.opponent || name === m.opponent2) {
        if (m.result === 'win') {
          playerMap[name].l++;
          playerMap[name].points -= 1;
        } else {
          playerMap[name].w++;
          playerMap[name].points += 2;
        }
      }
      // íŒŒíŠ¸ë„ˆì¸ ê²½ìš°
      else if (name === m.partner) {
        if (m.result === 'win') {
          playerMap[name].w++;
          playerMap[name].points += 2;
        } else {
          playerMap[name].l++;
          playerMap[name].points -= 1;
        }
      }
    });
  });
  
  // ë‚˜ë¥¼ playerMapì— ì¶”ê°€
  if (state.matches.length > 0) {
    playerMap[myName] = myStats;
  }
  
  // ì ìˆ˜ ìš°ì„ , ìŠ¹ë¥  ì°¨ìˆœìœ„ë¡œ ì •ë ¬
  const sorted = Object.entries(playerMap).sort((a, b) => {
    const [nameA, dataA] = a;
    const [nameB, dataB] = b;
    
    // 1ìˆœìœ„: ì ìˆ˜
    if (dataB.points !== dataA.points) {
      return dataB.points - dataA.points;
    }
    
    // 2ìˆœìœ„: ìŠ¹ë¥ 
    const totalA = dataA.w + dataA.l;
    const totalB = dataB.w + dataB.l;
    const rateA = totalA ? dataA.w / totalA : 0;
    const rateB = totalB ? dataB.w / totalB : 0;
    return rateB - rateA;
  });
  
  if (!sorted.length) {
    const sportIcon = state.sportType === 'tennis' ? 'ğŸ¾' : 'ğŸ¸';
    document.getElementById('rankingCard').innerHTML = `<div class="empty-state"><div class="empty-icon">${sportIcon}</div><div class="empty-text">ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´ ìˆœìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>`;
    return;
  }
  
  const rows = sorted.map(([name, d], i) => {
    const total = d.w + d.l;
    const rate = Math.round(d.w / total * 100);
    const isMe = name === myName;
    const cls = isMe ? 'rank-me' : i === 0 ? 'rank-first' : i === 1 ? 'rank-second' : i === 2 ? 'rank-third' : '';
    const pointsStr = d.points >= 0 ? `+${d.points}` : d.points;
    const nameDisplay = isMe ? `<strong>${name}</strong>` : name;
    return `<tr class="${cls}"><td class="rank-num">${i+1}</td><td>${nameDisplay}</td><td style="font-weight:700;color:var(--accent);">${pointsStr}ì </td><td>${total}ì „</td><td class="rank-rate">${rate}%</td></tr>`;
  }).join('');
  
  document.getElementById('rankingCard').innerHTML = `<table class="rank-table"><thead><tr><th></th><th>ì„ ìˆ˜</th><th>ì ìˆ˜</th><th>ê²½ê¸°</th><th>ìŠ¹ë¥ </th></tr></thead><tbody>${rows}</tbody></table>`;
}

function renderPartnerStats() {
  const doubles = state.matches.filter(m => m.format === 'doubles' && m.partner);
  const pm = {};
  doubles.forEach(m => {
    if (!pm[m.partner]) pm[m.partner] = { w: 0, l: 0 };
    if (m.result === 'win') pm[m.partner].w++; else pm[m.partner].l++;
  });
  if (!Object.keys(pm).length) {
    document.getElementById('partnerCard').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ¤</div><div class="empty-text">ë³µì‹ ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´ íŒŒíŠ¸ë„ˆ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>';
    return;
  }
  const html = Object.entries(pm).sort((a,b)=>(b[1].w+b[1].l)-(a[1].w+a[1].l)).map(([name,d])=>{
    const total = d.w+d.l; const rate=Math.round(d.w/total*100);
    return `<div class="opponent-bar"><div class="opponent-name"><span>${name}</span><span style="color:var(--accent);font-weight:700;">${d.w}ìŠ¹${d.l}íŒ¨ (${rate}%)</span></div><div class="bar-track"><div class="bar-fill" style="width:${rate}%"></div></div></div>`;
  }).join('');
  document.getElementById('partnerCard').innerHTML = html;
}

function renderOpponentStats() {
  const om = {};
  state.matches.forEach(m => {
    [m.opponent, m.opponent2].filter(Boolean).forEach(name => {
      if (!om[name]) om[name] = { w: 0, l: 0 };
      if (m.result === 'win') om[name].w++; else om[name].l++;
    });
  });
  if (!Object.keys(om).length) {
    document.getElementById('opponentCard').innerHTML = '<div class="empty-state"><div class="empty-icon">âš”ï¸</div><div class="empty-text">ê²½ê¸°ë¥¼ ì…ë ¥í•˜ë©´ ìƒëŒ€ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div></div>';
    return;
  }
  const html = Object.entries(om).sort((a,b)=>(b[1].w+b[1].l)-(a[1].w+a[1].l)).map(([name,d])=>{
    const total=d.w+d.l; const rate=Math.round(d.w/total*100);
    return `<div class="opponent-bar"><div class="opponent-name"><span>${name}</span><span style="color:var(--accent);font-weight:700;">${d.w}ìŠ¹${d.l}íŒ¨ (${rate}%)</span></div><div class="bar-track"><div class="bar-fill" style="width:${rate}%"></div></div></div>`;
  }).join('');
  document.getElementById('opponentCard').innerHTML = html;
}

// ===== PLAYERS =====
function addPlayer() {
  const name = document.getElementById('newPlayerName').value.trim();
  if (!name) { showToast('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  if (state.players.find(p => p.name === name)) { showToast('âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ì„ ìˆ˜ì…ë‹ˆë‹¤'); return; }
  state.players.push({ id: state.nextPlayerId++, name, memo: '' });
  save();
  document.getElementById('newPlayerName').value = '';
  renderPlayers();
  showToast(`âœ… ${name} ì¶”ê°€ ì™„ë£Œ!`);
}

function renderPlayers() {
  const el = document.getElementById('playerList');
  if (!state.players.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-text">ì„ ìˆ˜ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</div></div>';
    return;
  }
  el.innerHTML = state.players.map(p => {
    const initial = p.name.charAt(0);
    const memoPreview = p.memo ? `<div class="player-memo-preview">ğŸ“ ë©”ëª¨: ${p.memo}</div>` : '';
    return `<li class="player-item" id="playerItem-${p.id}">
      <div class="player-item-main">
        <div class="player-avatar-sm">${initial}</div>
        <div class="player-info">
          <div class="player-name">${escHtml(p.name)}</div>
          <div class="player-meta">ë“±ë¡ëœ ì„ ìˆ˜</div>
          ${memoPreview}
        </div>
        <div class="player-actions">
          <button class="player-action-btn edit-btn" onclick="toggleEdit(${p.id})" title="ì´ë¦„ ìˆ˜ì •">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </button>
          <button class="player-action-btn" onclick="toggleMemo(${p.id})" title="ë©”ëª¨ ì¶”ê°€/ìˆ˜ì •" style="color:var(--accent);">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          </button>
          <button class="player-action-btn delete-btn" onclick="deletePlayer(${p.id})" title="ì‚­ì œ">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
          </button>
        </div>
      </div>
      <!-- EDIT AREA -->
      <div class="player-edit-area" id="editArea-${p.id}">
        <div class="memo-label">âœï¸ ì´ë¦„ ìˆ˜ì •</div>
        <div class="edit-row">
          <input class="form-input" id="editInput-${p.id}" value="${escHtml(p.name)}" placeholder="ìƒˆ ì´ë¦„">
          <button class="edit-confirm-btn" onclick="confirmEdit(${p.id})">ì €ì¥</button>
          <button class="edit-cancel-btn" onclick="cancelEdit(${p.id})">ì·¨ì†Œ</button>
        </div>
      </div>
      <!-- MEMO AREA -->
      <div class="player-memo-area" id="memoArea-${p.id}">
        <div class="memo-label">ğŸ“ ì„ ìˆ˜ ë©”ëª¨ (íŠ¹ì§•, ìŠ¤íƒ€ì¼ ë“±)</div>
        <textarea class="player-memo-input" id="memoInput-${p.id}" placeholder="ì˜ˆ) ìˆ˜ë¹„ ìŠ¤íƒ€ì¼ë¡œ ë°œë¦¬ ì˜ ì•ˆ ë“¤ì–´ì˜´&#10;ì˜ˆ) ë“œë¼ì´ë¸Œ ê°•í•¨, í’‹ì›Œí¬ ë¹ ë¦„">${escHtml(p.memo || '')}</textarea>
        <button class="memo-save-btn" onclick="saveMemo(${p.id})">ğŸ’¾ ë©”ëª¨ ì €ì¥</button>
      </div>
    </li>`;
  }).join('');
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function toggleEdit(id) {
  const area = document.getElementById('editArea-' + id);
  const memoArea = document.getElementById('memoArea-' + id);
  const isOpen = area.classList.contains('open');
  // close all edit areas
  document.querySelectorAll('.player-edit-area.open').forEach(a => a.classList.remove('open'));
  document.querySelectorAll('.player-memo-area.open').forEach(a => a.classList.remove('open'));
  if (!isOpen) {
    area.classList.add('open');
    setTimeout(() => document.getElementById('editInput-' + id)?.focus(), 50);
  }
}

function cancelEdit(id) {
  document.getElementById('editArea-' + id).classList.remove('open');
}

function confirmEdit(id) {
  const input = document.getElementById('editInput-' + id);
  const newName = input.value.trim();
  if (!newName) { showToast('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  const player = state.players.find(p => p.id === id);
  if (!player) return;
  const oldName = player.name;
  if (newName === oldName) { cancelEdit(id); return; }
  if (state.players.find(p => p.name === newName && p.id !== id)) {
    showToast('âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ì´ë¦„ì…ë‹ˆë‹¤'); return;
  }
  player.name = newName;
  // also update matches
  state.matches.forEach(m => {
    if (m.opponent === oldName) m.opponent = newName;
    if (m.opponent2 === oldName) m.opponent2 = newName;
    if (m.partner === oldName) m.partner = newName;
  });
  save();
  renderPlayers();
  showToast(`âœ… ${newName}ìœ¼ë¡œ ìˆ˜ì • ì™„ë£Œ!`);
}

function toggleMemo(id) {
  const area = document.getElementById('memoArea-' + id);
  const editArea = document.getElementById('editArea-' + id);
  const isOpen = area.classList.contains('open');
  // close all
  document.querySelectorAll('.player-edit-area.open').forEach(a => a.classList.remove('open'));
  document.querySelectorAll('.player-memo-area.open').forEach(a => a.classList.remove('open'));
  if (!isOpen) {
    area.classList.add('open');
    setTimeout(() => document.getElementById('memoInput-' + id)?.focus(), 50);
  }
}

function saveMemo(id) {
  const memo = document.getElementById('memoInput-' + id).value.trim();
  const player = state.players.find(p => p.id === id);
  if (!player) return;
  player.memo = memo;
  save();
  document.getElementById('memoArea-' + id).classList.remove('open');
  renderPlayers();
  showToast(memo ? 'ğŸ“ ë©”ëª¨ ì €ì¥ ì™„ë£Œ!' : 'ğŸ—‘ï¸ ë©”ëª¨ ì‚­ì œ ì™„ë£Œ');
}

function deletePlayer(id) {
  const player = state.players.find(p => p.id === id);
  if (!player) return;
  showConfirm(`"${player.name}" ì‚­ì œ`, 'ì„ ìˆ˜ë¥¼ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ê¸° ê¸°ë¡ì€ ìœ ì§€ë©ë‹ˆë‹¤.', 'ğŸ—‘ï¸', () => {
    state.players = state.players.filter(p => p.id !== id);
    save();
    renderPlayers();
    showToast('ğŸ—‘ï¸ ì„ ìˆ˜ ì‚­ì œ ì™„ë£Œ');
  });
}

// ===== BACKUP =====
function exportData() {
  const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `niji-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  showToast('ğŸ’¾ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!');
}
function importData(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const d = JSON.parse(e.target.result);
      Object.assign(state, d);
      // migrate
      if (state.players.length && typeof state.players[0] === 'string') {
        state.players = state.players.map((n, i) => ({ id: i+1, name: n, memo: '' }));
        state.nextPlayerId = state.players.length + 1;
      }
      state.players = state.players.map(p => ({ memo: '', ...p }));
      save();
      renderProfile();
      renderMatchList();
      showToast('âœ… ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!');
    } catch { showToast('âŒ íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜'); }
  };
  reader.readAsText(file);
  input.value = '';
}

// ===== SET TODAY DATE =====
function setTodayDate() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('matchDate').value = today;
}

// ===== INIT =====
load();
renderProfile();
renderMatchList();
setTodayDate();
</script>
</body>
</html>
